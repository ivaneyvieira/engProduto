import org.gradle.api.tasks.testing.logging.TestExceptionFormat
import org.jetbrains.kotlin.gradle.tasks.KotlinCompile

plugins {
  kotlin("jvm") version "1.6.0"
  id("org.gretty") version "3.0.6"  // https://github.com/gretty-gradle-plugin/gretty
  war
  id("com.vaadin") version "0.14.7.5"
}

val kotlin_version = "1.6.10"
val karibu_version = "1.1.1"
val vaadin_version = "14.7.7"

defaultTasks("clean", "build")

repositories {
  mavenCentral()
  maven { setUrl("https://maven.vaadin.com/vaadin-addons") }
}

gretty {
  contextPath = "/"
  servletContainer = "jetty9.4"
}

tasks.withType<Test> {
  useJUnitPlatform()
  testLogging {
    // to see the exceptions of failed tests in Travis-CI console.
    exceptionFormat = TestExceptionFormat.FULL
  }
}

dependencies {
  implementation("com.vaadin:vaadin-core:$vaadin_version") {
    // Webjars are only needed when running in Vaadin 13 compatibility mode
    listOf("com.vaadin.webjar", "org.webjars.bowergithub.insites",
           "org.webjars.bowergithub.polymer", "org.webjars.bowergithub.polymerelements",
           "org.webjars.bowergithub.vaadin", "org.webjars.bowergithub.webcomponents")
      .forEach { exclude(group = it) }
  }
  // Vaadin-on-Kotlin dependency, includes Vaadin
  // https://mvnrepository.com/artifact/com.github.mvysny.karibudsl/karibu-dsl
  implementation("com.github.mvysny.karibudsl:karibu-dsl:$karibu_version")

  implementation(kotlin("stdlib-jdk8"))

  // logging
  // currently we are logging through the SLF4J API to SLF4J-Simple. See src/main/resources/simplelogger.properties file for the logger configuration
  implementation("org.slf4j:slf4j-simple:1.7.32")

  // logging
  implementation("org.sql2o:sql2o:1.6.0")
  implementation("org.simpleflatmapper:sfm-sql2o:8.2.3")
  implementation("mysql:mysql-connector-java:5.1.48")
  implementation("net.sourceforge.jtds:jtds:1.3.1")
  implementation("org.imgscalr:imgscalr-lib:4.2")
  implementation("com.jcraft:jsch:0.1.55")
  implementation("org.cups4j:cups4j:0.7.8")
  // https://mvnrepository.com/artifact/org.jsoup/jsoup
  implementation("org.jsoup:jsoup:1.13.1")

  implementation("org.vaadin.tatu:twincolselect:1.2.0")
  implementation("org.vaadin.gatanaso:multiselect-combo-box-flow:1.1.0")
  implementation("org.vaadin.tabs:paged-tabs:2.0.1")
  implementation("org.claspina:confirm-dialog:2.0.0")

  implementation("org.vaadin.crudui:crudui:4.1.0")
  implementation("org.vaadin.stefan:lazy-download-button:1.0.0")
  //implementation("com.github.nwillc:poink:0.4.6")
  implementation("com.flowingcode.addons:font-awesome-iron-iconset:2.1.2")
  implementation("org.vaadin.haijian:exporter:3.0.1")
  implementation("com.github.doyaaaaaken:kotlin-csv-jvm:0.15.2")
  implementation("com.beust:klaxon:5.5")
  implementation("com.fasterxml.jackson.dataformat:jackson-dataformat-xml:2.12.3")
  implementation("com.github.wmixvideo:nfe:3.0.58")

  //implementation ("com.fasterxml.jackson.module:jackson-module-kotlin:2.12.3")

  //implementation("org.jetbrains.kotlin:kotlin-stdlib:$kotlin_version")

  implementation("org.jetbrains.kotlin:kotlin-reflect:$kotlin_version")
  // https://mvnrepository.com/artifact/net.sourceforge.dynamicreports/dynamicreports-core
  implementation("net.sourceforge.dynamicreports:dynamicreports-core:6.12.1") {
    exclude(group = "com.lowagie", module = "itext")
  }
  // https://mvnrepository.com/artifact/net.sf.jasperreports/jasperreports-fonts
  implementation("net.sf.jasperreports:jasperreports:6.17.0")
  implementation("net.sf.jasperreports:jasperreports-fonts:6.17.0")
  implementation("de.f0rce.signaturepad:signature-widget:2.0.0")

  implementation("com.lowagie:itext:2.1.7")
  implementation("javax.xml.bind:jaxb-api:2.3.1")
  implementation("com.sun.mail:javax.mail:1.6.2")
  implementation("com.sun.mail:gimap:1.6.2")
}

tasks.withType<KotlinCompile> {
  kotlinOptions.jvmTarget = "1.8"
}

java {
  sourceCompatibility = JavaVersion.VERSION_1_8
  targetCompatibility = JavaVersion.VERSION_1_8
}

vaadin {
  productionMode = true
}